# MathMind monorepo

Мобильный-first продукт для тренировки математических рассуждений (5–7 классы).

## Структура
- `backend/` — Go + PostgreSQL, REST API, явные SQL-миграции.
- `apps/mobile/` — Flutter-приложение (ученик + учитель, мобильная вёрстка).
- `docker-compose.yml` — Postgres + backend.

## Быстрый старт через Docker
Требования: Docker + docker-compose.

```bash
# в корне репозитория
docker-compose up --build
```

После запуска:
- Backend: http://localhost:8080
- Сервис применяет миграции автоматически.
- Демо-учитель: `teacher@mathmind.ru` / `parol123`
- Демо-класс: код `MATH7A`

Остановка:
```bash
docker-compose down
```

## Локальный запуск backend (без Docker)
Требования: Go 1.21+, PostgreSQL.

1. Запустите Postgres и создайте БД `mathmind` с пользователем `mathmind:mathmind` (или задайте переменную `DATABASE_URL`).
2. Примените миграции автоматически при старте сервера: `cd backend && go run ./cmd/server`
3. Сервер слушает порт `8080` (переопределяется `PORT`).

### Переменные окружения
- `DATABASE_URL` — строка подключения, по умолчанию `postgres://mathmind:mathmind@localhost:5432/mathmind?sslmode=disable`
- `AI_API_KEY` — опциональный ключ внешнего AI-провайдера (при отсутствии возвращается заглушка).

## Эндпоинты REST
- `POST /auth/teacher/login` — вход учителя (простая проверка пароля).
- `POST /classes` — создать класс (teacher_id, name) → invite_code.
- `POST /classes/join` — ученик присоединяется по коду (создаёт student + связь).
- `GET /topics` — список тем с количеством задач.
- `GET /tasks?topic_id=` — задачи по теме с decision tree.
- `POST /attempts` — сохранить шаг попытки (фиксирует ошибки и подсказки).
- `GET /teacher/analytics?class_id=` — агрегированные ошибки и последние шаги.
- `POST /teacher/ai` — AI-помощник (черновик или вызов провайдера по ключу).

## Данные из миграций
- 2 темы: «Проценты и скидки», «Дроби и пропорции».
- 12 задач (по 6 на тему) с 2–3 decision-узлами и подсказками по ошибкам.
- Демо учитель/класс/ученики для быстрого теста.

## Мобильное приложение (Flutter)
Требования: Flutter 3.3+.

```bash
cd apps/mobile
flutter pub get
flutter run -d chrome   # или ваш эмулятор/устройство
```

Функции:
- Ученик: форма «Присоединиться в класс», список тем, список задач, раннер шагов, подсказки, завершение.
- Учитель: вход, создание класса (код приглашения), аналитика ошибок по классу, AI-ассистент со стуб-ответом.

## Разработка
- SQL миграции лежат в `backend/migrations`, применяются автоматически при старте сервера.
- Код стилем Go fmt (использован стандартный `gofmt`).
- UI и тексты на русском, мобильные карточные лэйауты.
